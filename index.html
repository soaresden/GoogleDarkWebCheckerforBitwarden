<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>DarkWeb Checker</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', sans-serif;
            background: #0f1419;
            color: #e8eef5;
            height: 100vh;
            overflow: hidden;
            display: flex;
            flex-direction: column;
        }

        .navbar {
            background: #1a2332;
            border-bottom: 2px solid #1e90ff;
            padding: 15px 20px;
            display: flex;
            align-items: center;
            gap: 20px;
        }

        .navbar h1 {
            font-size: 1.2em;
            color: #1e90ff;
            margin: 0;
        }

        .navbar label {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 8px 15px;
            background: #0f1419;
            border: 1px solid #1e90ff;
            border-radius: 4px;
            cursor: pointer;
            transition: all 0.2s;
        }

        .navbar label:hover {
            background: #1e90ff;
            color: white;
        }

        #jsonFile {
            display: none;
        }

        .navbar .status {
            margin-left: auto;
            font-size: 0.9em;
            color: #a0aec0;
        }

        .main-container {
            display: flex;
            flex: 1;
            overflow: hidden;
        }

        .left-panel {
            width: 350px;
            background: #1a2332;
            border-right: 1px solid #2a3a4d;
            overflow-y: auto;
            padding: 20px;
        }

        .left-panel h2 {
            font-size: 0.9em;
            color: #a0aec0;
            text-transform: uppercase;
            margin-bottom: 15px;
            letter-spacing: 1px;
        }

        #patternInput {
            width: 100%;
            height: 200px;
            background: #0a0e13;
            border: 1px solid #2a3a4d;
            border-radius: 4px;
            padding: 12px;
            color: #e8eef5;
            font-family: 'Courier New', monospace;
            font-size: 0.9em;
            resize: none;
            margin-bottom: 15px;
        }

        #patternInput:focus {
            outline: none;
            border-color: #1e90ff;
        }

        .pattern-list {
            background: #0a0e13;
            border: 1px solid #2a3a4d;
            border-radius: 4px;
            max-height: 300px;
            overflow-y: auto;
            padding: 10px;
        }

        .pattern-tag {
            display: inline-block;
            background: #1e90ff;
            color: white;
            padding: 4px 10px;
            border-radius: 3px;
            font-size: 0.8em;
            margin: 3px;
            font-family: 'Courier New', monospace;
            font-weight: bold;
        }

        .right-panel {
            flex: 1;
            overflow-y: auto;
            padding: 20px;
        }

        .stats {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 10px;
            margin-bottom: 20px;
        }

        .stat {
            background: #1a2332;
            padding: 15px;
            border-radius: 4px;
            text-align: center;
            border-left: 4px solid #1e90ff;
        }

        .stat.danger {
            border-left-color: #ff4757;
        }

        .stat.success {
            border-left-color: #2ed573;
        }

        .stat-number {
            font-size: 1.5em;
            font-weight: bold;
            margin: 5px 0;
        }

        .stat.danger .stat-number {
            color: #ff4757;
        }

        .stat.success .stat-number {
            color: #2ed573;
        }

        .stat-label {
            font-size: 0.75em;
            color: #a0aec0;
            text-transform: uppercase;
        }

        .results-container {
            display: flex;
            flex-direction: column;
            gap: 0;
            border: 1px solid #2a3a4d;
            border-radius: 4px;
            overflow: hidden;
        }

        .result-row {
            display: grid;
            grid-template-columns: 150px 80px 1fr;
            gap: 15px;
            padding: 10px 15px;
            background: #1a2332;
            border-bottom: 1px solid #2a3a4d;
            align-items: center;
            font-size: 0.9em;
            word-break: break-word;
        }

        .result-row:last-child {
            border-bottom: none;
        }

        .result-row.header {
            background: #0a0e13;
            font-weight: bold;
            color: #1e90ff;
            text-transform: uppercase;
            font-size: 0.8em;
            padding: 12px 15px;
        }

        .result-pattern {
            font-family: 'Courier New', monospace;
            font-weight: bold;
            color: #1e90ff;
        }

        .result-count {
            background: #ff4757;
            color: white;
            padding: 2px 6px;
            border-radius: 3px;
            font-size: 0.8em;
            font-weight: bold;
            text-align: center;
        }

        .result-count.safe {
            background: #2ed573;
        }

        .result-site {
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .result-site-link {
            color: #1e90ff;
            text-decoration: none;
            word-break: break-all;
            transition: color 0.2s;
            flex: 1;
        }

        .result-site-link:hover {
            color: #2ed573;
            text-decoration: underline;
        }

        .result-site-folder {
            color: #a0aec0;
            font-size: 0.75em;
            white-space: nowrap;
            padding: 2px 6px;
            background: #0a0e13;
            border-radius: 3px;
        }

        .empty-state {
            text-align: center;
            padding: 40px;
            color: #a0aec0;
        }

        @media (max-width: 1024px) {
            .main-container {
                flex-direction: column;
            }

            .left-panel {
                width: 100%;
                border-right: none;
                border-bottom: 1px solid #2a3a4d;
                padding: 15px;
            }

            .stats {
                grid-template-columns: repeat(2, 1fr);
            }

            .result-row {
                grid-template-columns: 100px 50px 1fr;
                gap: 10px;
            }
        }

        @media (max-width: 768px) {
            .navbar {
                flex-direction: column;
                align-items: flex-start;
            }

            .navbar .status {
                margin-left: 0;
            }

            .stats {
                grid-template-columns: 1fr;
            }

            .result-row {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="navbar">
        <h1>üîí DARKWEB CHECKER</h1>
        <label>
            üìÇ Import JSON
            <input type="file" id="jsonFile" accept=".json">
        </label>
        <div class="status" id="status">Ready</div>
    </div>

    <div class="main-container">
        <div class="left-panel">
            <h2>Patterns</h2>
            <textarea id="patternInput" placeholder="Paste patterns here&#10;w‚Ä¢‚Ä¢‚Ä¢‚Ä¢&#10;gja‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢"></textarea>
            
            <h2>Loaded</h2>
            <div class="pattern-list" id="patternList"></div>
        </div>

        <div class="right-panel">
            <div class="stats" id="stats"></div>
            <div class="results-container" id="results"></div>
        </div>
    </div>

    <script>
        class DarkWebChecker {
            constructor() {
                this.data = null;
                this.patterns = [];
                this.setupEventListeners();
            }

            setupEventListeners() {
                document.getElementById('jsonFile').addEventListener('change', (e) => this.loadJSON(e));
                document.getElementById('patternInput').addEventListener('input', () => this.parsePatterns());
            }

            loadJSON(event) {
                const file = event.target.files[0];
                if (!file) return;

                const reader = new FileReader();
                reader.onload = (e) => {
                    try {
                        this.data = JSON.parse(e.target.result);
                        this.updateFolders();
                        this.render();
                        document.getElementById('status').textContent = `‚úì ${file.name} loaded`;
                    } catch (err) {
                        alert('Invalid JSON file');
                        document.getElementById('status').textContent = 'Error loading file';
                    }
                };
                reader.readAsText(file);
            }

            updateFolders() {
                this.folders = {};
                if (this.data.folders) {
                    this.data.folders.forEach(f => this.folders[f.id] = f.name);
                }
            }

            parsePatterns() {
                const text = document.getElementById('patternInput').value;
                this.patterns = [];

                text.split('\n').forEach(line => {
                    line = line.trim();
                    if (line) {
                        const bullets = (line.match(/‚Ä¢/g) || []).length;
                        const prefix = line.replace(/‚Ä¢/g, '');
                        if (prefix) {
                            this.patterns.push({
                                prefix,
                                totalLength: prefix.length + bullets,
                                display: line
                            });
                        }
                    }
                });

                this.render();
            }

            checkPassword(password) {
                if (!password) return null;
                
                for (let p of this.patterns) {
                    if (password.startsWith(p.prefix) && password.length === p.totalLength) {
                        return p;
                    }
                }
                return null;
            }

            isValidUrl(string) {
                try {
                    new URL(string);
                    return true;
                } catch (_) {
                    return false;
                }
            }

            getLink(siteName) {
                if (this.isValidUrl(siteName)) {
                    return siteName;
                }
                return 'https://' + siteName;
            }

            render() {
                this.renderPatternList();
                if (!this.data) {
                    document.getElementById('results').innerHTML = '<div class="empty-state">Import a Bitwarden JSON file</div>';
                    return;
                }

                const analysis = this.analyze();
                this.renderStats(analysis);
                this.renderResults(analysis);
            }

            renderPatternList() {
                const html = this.patterns.map(p => 
                    `<span class="pattern-tag">${this.escapeHtml(p.display)}</span>`
                ).join('');
                document.getElementById('patternList').innerHTML = html || '<div style="color: #a0aec0; font-size: 0.85em;">No patterns</div>';
            }

            analyze() {
                const results = {};
                this.patterns.forEach(p => {
                    results[p.display] = [];
                });

                if (!this.data.items) return results;

                this.data.items.forEach(item => {
                    if (item.type !== 1) return;

                    const login = item.login || {};
                    const password = login.password;
                    if (!password) return;

                    const pattern = this.checkPassword(password);
                    if (!pattern) return;

                    const entry = {
                        name: item.name,
                        folder: this.folders[item.folderId] || 'N/A'
                    };

                    // Check history
                    const history = item.passwordHistory || [];
                    let foundInHistory = false;
                    for (let h of history) {
                        if (this.checkPassword(h.password)) {
                            foundInHistory = true;
                            break;
                        }
                    }

                    results[pattern.display].push({
                        ...entry,
                        changed: foundInHistory
                    });
                });

                return results;
            }

            renderStats(analysis) {
                let totalActive = 0;
                let totalChanged = 0;
                let totalSafe = 0;

                if (this.data.items) {
                    totalSafe = this.data.items.filter(i => i.type === 1 && i.login?.password).length;
                    Object.values(analysis).forEach(items => {
                        items.forEach(item => {
                            if (item.changed) {
                                totalChanged++;
                            } else {
                                totalActive++;
                            }
                        });
                    });
                    totalSafe -= (totalActive + totalChanged);
                }

                const total = totalActive + totalChanged + totalSafe;
                const risk = total > 0 ? Math.round(totalActive / total * 100) : 0;

                const statsHtml = `
                    <div class="stat danger">
                        <div class="stat-label">üî¥ Active</div>
                        <div class="stat-number">${totalActive}</div>
                    </div>
                    <div class="stat" style="border-left-color: #ffa502;">
                        <div class="stat-label">‚úÖ Changed</div>
                        <div class="stat-number">${totalChanged}</div>
                    </div>
                    <div class="stat success">
                        <div class="stat-label">üü¢ Safe</div>
                        <div class="stat-number">${totalSafe}</div>
                    </div>
                    <div class="stat danger">
                        <div class="stat-label">‚ö†Ô∏è Risk</div>
                        <div class="stat-number">${risk}%</div>
                    </div>
                `;
                document.getElementById('stats').innerHTML = statsHtml;
            }

            renderResults(analysis) {
                if (!this.patterns.length) {
                    document.getElementById('results').innerHTML = '<div class="empty-state">Add patterns on the left</div>';
                    return;
                }

                let html = '<div class="result-row header"><div>Pattern</div><div>Count</div><div>Site</div></div>';
                
                Object.entries(analysis).forEach(([patternName, items]) => {
                    if (items.length === 0) return;

                    items.forEach((item, idx) => {
                        const link = this.getLink(item.name);
                        const isFirstRow = idx === 0;
                        
                        html += `
                            <div class="result-row">
                                ${isFirstRow ? `<div class="result-pattern">${this.escapeHtml(patternName)}</div>` : '<div></div>'}
                                ${isFirstRow ? `<div class="result-count ${item.changed ? 'safe' : ''}">${items.length}</div>` : '<div></div>'}
                                <div class="result-site">
                                    <a href="${this.escapeHtml(link)}" target="_blank" class="result-site-link">${this.escapeHtml(item.name)}</a>
                                    <span class="result-site-folder">${item.folder}</span>
                                </div>
                            </div>
                        `;
                    });
                });

                document.getElementById('results').innerHTML = html || '<div class="empty-state">No results</div>';
            }

            escapeHtml(text) {
                const map = { '&': '&amp;', '<': '&lt;', '>': '&gt;', '"': '&quot;', "'": '&#039;' };
                return text.replace(/[&<>"']/g, m => map[m]);
            }
        }

        new DarkWebChecker();
    </script>
</body>
</html>