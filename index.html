<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>DARKWEB CHECKER</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@300;400;600;700;800&family=JetBrains+Mono:wght@400;600&display=swap" rel="stylesheet">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --primary: #00d4ff;
            --secondary: #ff006e;
            --accent: #8338ec;
            --bg-dark: #0a0e27;
            --bg-light: #1a1f3a;
            --text-primary: #f0f4ff;
            --text-secondary: #a0aec0;
            --success: #00d98e;
        }

        body {
            font-family: 'Outfit', sans-serif;
            background: linear-gradient(135deg, var(--bg-dark) 0%, #0f1629 50%, #1a0f2e 100%);
            color: var(--text-primary);
            height: 100vh;
            overflow: hidden;
            display: flex;
            flex-direction: column;
            position: relative;
        }

        /* Animated background elements */
        body::before {
            content: '';
            position: fixed;
            top: -50%;
            right: -10%;
            width: 500px;
            height: 500px;
            background: radial-gradient(circle, rgba(0, 212, 255, 0.1) 0%, transparent 70%);
            border-radius: 50%;
            animation: float 20s ease-in-out infinite;
            pointer-events: none;
            z-index: 0;
        }

        body::after {
            content: '';
            position: fixed;
            bottom: -20%;
            left: 5%;
            width: 400px;
            height: 400px;
            background: radial-gradient(circle, rgba(255, 0, 110, 0.08) 0%, transparent 70%);
            border-radius: 50%;
            animation: float 25s ease-in-out infinite reverse;
            pointer-events: none;
            z-index: 0;
        }

        @keyframes float {
            0%, 100% { transform: translateY(0px); }
            50% { transform: translateY(30px); }
        }

        .container {
            position: relative;
            z-index: 1;
            display: flex;
            flex-direction: column;
            height: 100vh;
            gap: 20px;
            padding: 20px;
        }

        /* NAVBAR */
        .navbar {
            background: rgba(26, 31, 58, 0.5);
            backdrop-filter: blur(20px);
            border: 1px solid rgba(0, 212, 255, 0.2);
            border-radius: 16px;
            padding: 20px 30px;
            display: flex;
            align-items: center;
            justify-content: space-between;
            animation: slideDown 0.6s ease-out;
        }

        @keyframes slideDown {
            from {
                opacity: 0;
                transform: translateY(-20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .navbar-left {
            display: flex;
            align-items: center;
            gap: 20px;
        }

        .navbar h1 {
            font-size: 1.8em;
            font-weight: 800;
            letter-spacing: -1px;
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .navbar-badge {
            font-size: 0.8em;
            color: var(--text-secondary);
            padding: 4px 12px;
            background: rgba(0, 212, 255, 0.1);
            border-radius: 50px;
            border: 1px solid rgba(0, 212, 255, 0.3);
        }

        .navbar label {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 10px 20px;
            background: linear-gradient(135deg, var(--primary), var(--accent));
            color: white;
            border: none;
            border-radius: 12px;
            cursor: pointer;
            font-weight: 600;
            font-size: 0.9em;
            transition: all 0.3s ease;
            margin-left: auto;
        }

        .navbar label:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 32px rgba(0, 212, 255, 0.4);
        }

        #jsonFile {
            display: none;
        }

        .navbar-status {
            color: var(--text-secondary);
            font-size: 0.9em;
            animation: pulse 2s ease-in-out infinite;
        }

        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.6; }
        }

        /* MAIN LAYOUT */
        .main-content {
            display: flex;
            gap: 20px;
            flex: 1;
            min-height: 0;
            animation: fadeIn 0.8s ease-out 0.2s both;
        }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        .sidebar {
            width: 320px;
            background: rgba(26, 31, 58, 0.4);
            backdrop-filter: blur(20px);
            border: 1px solid rgba(0, 212, 255, 0.1);
            border-radius: 16px;
            padding: 25px;
            overflow-y: auto;
            display: flex;
            flex-direction: column;
            gap: 20px;
        }

        .sidebar h2 {
            font-size: 0.75em;
            text-transform: uppercase;
            letter-spacing: 2px;
            color: var(--primary);
            font-weight: 700;
        }

        #patternInput {
            width: 100%;
            height: 150px;
            background: rgba(10, 14, 39, 0.6);
            border: 1px solid rgba(0, 212, 255, 0.2);
            border-radius: 12px;
            padding: 15px;
            color: var(--text-primary);
            font-family: 'JetBrains Mono', monospace;
            font-size: 0.9em;
            resize: none;
            transition: all 0.3s ease;
        }

        #patternInput:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 20px rgba(0, 212, 255, 0.2);
            background: rgba(10, 14, 39, 0.8);
        }

        .pattern-list {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
            min-height: 30px;
        }

        .pattern-tag {
            display: inline-flex;
            align-items: center;
            gap: 6px;
            background: rgba(0, 212, 255, 0.15);
            border: 1px solid var(--primary);
            color: var(--primary);
            padding: 6px 12px;
            border-radius: 20px;
            font-size: 0.8em;
            font-family: 'JetBrains Mono', monospace;
            font-weight: 600;
            animation: scaleIn 0.3s ease-out;
        }

        @keyframes scaleIn {
            from {
                opacity: 0;
                transform: scale(0.8);
            }
            to {
                opacity: 1;
                transform: scale(1);
            }
        }

        .clear-btn {
            padding: 8px 16px;
            background: rgba(255, 0, 110, 0.2);
            border: 1px solid var(--secondary);
            color: var(--secondary);
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
            font-size: 0.85em;
            transition: all 0.3s ease;
        }

        .clear-btn:hover {
            background: rgba(255, 0, 110, 0.3);
            transform: translateY(-2px);
        }

        /* CONTENT */
        .content {
            flex: 1;
            display: flex;
            flex-direction: column;
            gap: 15px;
            min-width: 0;
            overflow-y: auto;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 12px;
            animation: fadeIn 0.8s ease-out 0.4s both;
        }

        .stat-card {
            background: rgba(26, 31, 58, 0.4);
            backdrop-filter: blur(20px);
            border: 1px solid rgba(0, 212, 255, 0.1);
            border-radius: 12px;
            padding: 20px;
            text-align: center;
            transition: all 0.3s ease;
        }

        .stat-card:hover {
            border-color: var(--primary);
            background: rgba(26, 31, 58, 0.6);
            transform: translateY(-4px);
        }

        .stat-card.danger {
            border-color: rgba(255, 0, 110, 0.3);
        }

        .stat-card.danger:hover {
            border-color: var(--secondary);
        }

        .stat-number {
            font-size: 2.5em;
            font-weight: 800;
            margin: 10px 0;
            background: linear-gradient(135deg, var(--primary), var(--accent));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .stat-card.danger .stat-number {
            background: linear-gradient(135deg, var(--secondary), #ff4060);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .stat-label {
            font-size: 0.75em;
            text-transform: uppercase;
            letter-spacing: 1px;
            color: var(--text-secondary);
            font-weight: 600;
        }

        .results {
            background: rgba(26, 31, 58, 0.4);
            backdrop-filter: blur(20px);
            border: 1px solid rgba(0, 212, 255, 0.1);
            border-radius: 16px;
            padding: 20px;
            display: flex;
            flex-direction: column;
            gap: 12px;
            animation: fadeIn 0.8s ease-out 0.6s both;
        }

        .pattern-folder {
            background: rgba(10, 14, 39, 0.5);
            border: 1px solid rgba(0, 212, 255, 0.2);
            border-radius: 10px;
            overflow: hidden;
            animation: slideUp 0.4s ease-out;
        }

        .pattern-folder.opened {
            position: sticky;
            top: 0;
            z-index: 10;
            background: rgba(26, 31, 58, 0.95);
            backdrop-filter: blur(20px);
            padding-bottom: 10px;
            box-shadow: 0 4px 16px rgba(0, 0, 0, 0.3);
        }

        .pattern-folder-header {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 14px;
            cursor: pointer;
            background: rgba(0, 212, 255, 0.08);
            transition: all 0.3s ease;
            user-select: none;
        }

        .pattern-folder-header:hover {
            background: rgba(0, 212, 255, 0.15);
            transform: translateX(4px);
        }

        .folder-toggle {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            width: 20px;
            height: 20px;
            color: var(--primary);
            transition: transform 0.3s ease;
            font-size: 1.2em;
            cursor: pointer;
        }

        .folder-toggle.collapsed {
            transform: rotate(-90deg);
        }

        .folder-minimize {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            width: 20px;
            height: 20px;
            color: var(--text-secondary);
            transition: all 0.2s ease;
            font-size: 0.9em;
            cursor: pointer;
            margin-left: auto;
        }

        .folder-minimize:hover {
            color: var(--primary);
        }

        .folder-title {
            font-family: 'JetBrains Mono', monospace;
            font-weight: 700;
            color: var(--primary);
            font-size: 0.95em;
            flex: 1;
        }

        .folder-count {
            background: rgba(255, 0, 110, 0.2);
            color: var(--secondary);
            padding: 4px 10px;
            border-radius: 6px;
            font-size: 0.75em;
            font-weight: 700;
        }

        .pattern-folder-content {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
            gap: 10px;
            padding: 12px;
            transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
            opacity: 1;
        }

        .pattern-folder-content.collapsed {
            max-height: 0;
            padding: 0 12px;
            opacity: 0;
            overflow: hidden;
        }

        .result-item {
            padding: 10px;
            background: rgba(10, 14, 39, 0.5);
            border: 1px solid rgba(0, 212, 255, 0.15);
            border-radius: 10px;
            transition: all 0.3s ease;
            animation: slideUp 0.4s ease-out;
            display: flex;
            flex-direction: column;
            gap: 6px;
            cursor: pointer;
        }

        .result-item.tracked {
            background: rgba(255, 193, 7, 0.1);
            border-color: #ffc107;
            box-shadow: 0 0 20px rgba(255, 193, 7, 0.5), inset 0 0 20px rgba(255, 193, 7, 0.1);
        }

        .result-header {
            display: flex;
            align-items: flex-start;
            gap: 6px;
            justify-content: space-between;
        }

        .result-pattern {
            font-family: 'JetBrains Mono', monospace;
            font-weight: 700;
            color: var(--primary);
            font-size: 0.75em;
            line-height: 1.2;
            word-break: break-word;
            flex: 1;
        }

        .result-link {
            color: var(--primary);
            text-decoration: none;
            font-weight: 600;
            font-size: 0.8em;
            transition: all 0.2s ease;
            word-break: break-word;
            flex: 1;
            line-height: 1.2;
        }

        .result-link:hover {
            color: var(--secondary);
            text-decoration: underline;
        }

        .result-folder {
            color: var(--text-secondary);
            font-size: 0.65em;
            padding: 1px 5px;
            background: rgba(0, 212, 255, 0.1);
            border-radius: 3px;
            white-space: nowrap;
            flex-shrink: 0;
        }

        .result-password {
            display: flex;
            gap: 4px;
            align-items: center;
            font-family: 'JetBrains Mono', monospace;
            font-size: 0.7em;
            word-break: break-all;
        }

        .password-value {
            background: rgba(0, 212, 255, 0.1);
            color: var(--success);
            padding: 2px 4px;
            border-radius: 3px;
            user-select: all;
        }

        .result-date {
            color: var(--text-secondary);
            font-size: 0.65em;
            margin-top: 1px;
        }

        .empty-state {
            text-align: center;
            padding: 60px 20px;
            color: var(--text-secondary);
        }

        .empty-state-icon {
            font-size: 4em;
            margin-bottom: 20px;
            opacity: 0.5;
        }

        .scrollbar-hide::-webkit-scrollbar {
            display: none;
        }

        @media (max-width: 1200px) {
            .main-content {
                flex-direction: column;
            }

            .sidebar {
                width: 100%;
            }

            .stats-grid {
                grid-template-columns: repeat(2, 1fr);
            }
        }

        @media (max-width: 768px) {
            .navbar {
                flex-direction: column;
                gap: 15px;
            }

            .navbar label {
                margin-left: 0;
                width: 100%;
                justify-content: center;
            }

            .stats-grid {
                grid-template-columns: 1fr;
            }

            .navbar h1 {
                font-size: 1.4em;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="navbar">
            <div class="navbar-left">
                <h1>üîê DARKWEB CHECKER</h1>
                <span class="navbar-badge">Security Audit</span>
            </div>
            <label>
                üìÇ Import JSON
                <input type="file" id="jsonFile" accept=".json">
            </label>
            <div class="navbar-status" id="status">Ready</div>
        </div>

        <div class="main-content">
            <div class="sidebar">
                <div>
                    <h2>Add Patterns</h2>
                    <textarea id="patternInput" placeholder="Paste patterns here&#10;w‚Ä¢‚Ä¢‚Ä¢‚Ä¢&#10;gja‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢" class="scrollbar-hide"></textarea>
                </div>

                <div>
                    <h2>Loaded</h2>
                    <div class="pattern-list" id="patternList"></div>
                </div>

                <button class="clear-btn" onclick="checker.clearMemory()">üóëÔ∏è Clear All</button>

                <div>
                    <h2>Ignored</h2>
                    <div id="ignoredList" style="color: var(--text-secondary); font-size: 0.85em;"></div>
                </div>

                <button style="padding: 10px 16px; background: linear-gradient(135deg, var(--success), #00d98e); border: none; color: white; border-radius: 8px; cursor: pointer; font-weight: 600; font-size: 0.9em; transition: all 0.3s ease; width: 100%;" onclick="checker.saveProgress()">üíæ Save Progress</button>
            </div>

            <div class="content">
                <div class="stats-grid" id="stats"></div>
                <div class="results scrollbar-hide" id="results"></div>
            </div>
        </div>
    </div>

    <input type="file" id="memoryFile" accept=".json" style="display: none;">
    <a id="downloadLink" style="display: none;"></a>

    <script>
        class DarkWebChecker {
            constructor() {
                this.data = null;
                this.patterns = [];
                this.memory = {};
                this.folders = {};
                this.currentJsonFile = null;
                this.currentJsonContent = null;
                this.tracked = new Set();
                this.setupEventListeners();
            }

            setupEventListeners() {
                document.getElementById('jsonFile').addEventListener('change', (e) => this.loadJSON(e));
                document.getElementById('patternInput').addEventListener('input', () => this.parsePatterns());
            }

            clearMemory() {
                if (confirm('Clear all marked items?')) {
                    this.memory = {};
                    this.render();
                }
            }

            isIgnored(patternDisplay, siteName) {
                const key = `${patternDisplay}|${siteName}`;
                return this.memory[key] === true;
            }

            markAsIgnored(patternDisplay, siteName) {
                const key = `${patternDisplay}|${siteName}`;
                this.memory[key] = true;
                this.render();
            }

            renderIgnoredList() {
                const ignoredCount = Object.keys(this.memory).length;
                const ignoredList = document.getElementById('ignoredList');
                if (ignoredCount === 0) {
                    ignoredList.innerHTML = '<span style="color: var(--text-secondary);">None</span>';
                } else {
                    const items = Object.keys(this.memory).slice(0, 5).map(key => {
                        const [pattern, site] = key.split('|');
                        return `<div style="margin: 4px 0; word-break: break-word;">${this.escapeHtml(site.substring(0, 30))}</div>`;
                    }).join('');
                    ignoredList.innerHTML = items + (ignoredCount > 5 ? `<div style="margin-top: 8px; color: var(--primary);">+${ignoredCount - 5} more</div>` : '');
                }
            }

            saveProgress() {
                if (!this.currentJsonFile || !this.data) {
                    alert('No JSON file loaded');
                    return;
                }

                // Add ignored info to the data
                const dataToSave = JSON.parse(JSON.stringify(this.data));
                dataToSave._ignored = this.memory;

                // Trigger download
                const dataStr = JSON.stringify(dataToSave, null, 2);
                const blob = new Blob([dataStr], { type: 'application/json' });
                const url = URL.createObjectURL(blob);
                const link = document.getElementById('downloadLink');
                link.href = url;
                link.download = this.currentJsonFile;
                link.click();
                URL.revokeObjectURL(url);
                
                alert('Progress saved! The file has been downloaded with your ignored items.');
            }

            toggleFolder(patternName) {
                // Ferme tous les dossiers
                this.patterns.forEach(p => {
                    const key = `folder_${p.display}`;
                    localStorage.setItem(key, 'true');
                });
                
                // Ouvre seulement celui-ci
                const key = `folder_${patternName}`;
                localStorage.setItem(key, 'false');
                
                this.render();
            }

            toggleTracked(patternName, siteName) {
                const key = `${patternName}|${siteName}`;
                if (this.tracked.has(key)) {
                    // Si c'est d√©j√† le glow actif, on l'√©teint
                    this.tracked.delete(key);
                } else {
                    // Sinon on vide tout et on met le nouveau
                    this.tracked.clear();
                    this.tracked.add(key);
                }
                this.renderResults(this.analyze());
            }

            isTracked(patternName, siteName) {
                const key = `${patternName}|${siteName}`;
                return this.tracked.has(key);
            }

            isFolderCollapsed(patternName) {
                const key = `folder_${patternName}`;
                const stored = localStorage.getItem(key);
                // Par d√©faut collapsed (true)
                return stored === null ? true : stored === 'true';
            }

            loadJSON(event) {
                const file = event.target.files[0];
                if (!file) return;

                const reader = new FileReader();
                reader.onload = (e) => {
                    try {
                        this.data = JSON.parse(e.target.result);
                        this.currentJsonFile = file.name;
                        this.currentJsonContent = this.data;
                        this.updateFolders();
                        
                        // Load ignored items from JSON
                        if (this.data._ignored) {
                            this.memory = this.data._ignored;
                        } else {
                            this.memory = {};
                        }
                        
                        this.render();
                        document.getElementById('status').textContent = `‚úì ${file.name}`;
                    } catch (err) {
                        alert('Invalid JSON file');
                        document.getElementById('status').textContent = 'Error';
                    }
                };
                reader.readAsText(file);
            }

            updateFolders() {
                this.folders = {};
                if (this.data.folders) {
                    this.data.folders.forEach(f => this.folders[f.id] = f.name);
                }
            }

            parsePatterns() {
                const text = document.getElementById('patternInput').value;
                this.patterns = [];

                text.split('\n').forEach(line => {
                    line = line.trim();
                    if (line) {
                        const bullets = (line.match(/‚Ä¢/g) || []).length;
                        const prefix = line.replace(/‚Ä¢/g, '');
                        if (prefix) {
                            this.patterns.push({
                                prefix,
                                totalLength: prefix.length + bullets,
                                display: line
                            });
                        }
                    }
                });

                this.render();
            }

            checkPassword(password) {
                if (!password) return null;
                for (let p of this.patterns) {
                    if (password.startsWith(p.prefix) && password.length === p.totalLength) {
                        return p;
                    }
                }
                return null;
            }

            isValidUrl(string) {
                try {
                    new URL(string);
                    return true;
                } catch (_) {
                    return false;
                }
            }

            getLink(siteName) {
                if (this.isValidUrl(siteName)) return siteName;
                return 'https://' + siteName;
            }

            formatDate(dateString) {
                if (!dateString) return 'N/A';
                const date = new Date(dateString);
                const d = String(date.getDate()).padStart(2, '0');
                const m = String(date.getMonth() + 1).padStart(2, '0');
                const y = date.getFullYear();
                return `${d}/${m}/${y}`;
            }

            render() {
                this.renderPatternList();
                if (!this.data) {
                    document.getElementById('results').innerHTML = '<div class="empty-state"><div class="empty-state-icon">üìÅ</div><p>Import your Bitwarden JSON file</p></div>';
                    return;
                }

                const analysis = this.analyze();
                this.renderStats(analysis);
                this.renderResults(analysis);
                this.renderIgnoredList();
            }

            renderPatternList() {
                const html = this.patterns.map(p => 
                    `<span class="pattern-tag">${this.escapeHtml(p.display)}</span>`
                ).join('');
                document.getElementById('patternList').innerHTML = html || '<span style="color: var(--text-secondary); font-size: 0.85em;">No patterns yet</span>';
            }

            analyze() {
                const results = {};
                this.patterns.forEach(p => {
                    results[p.display] = [];
                });

                if (!this.data.items) return results;

                this.data.items.forEach(item => {
                    if (item.type !== 1) return;

                    const login = item.login || {};
                    const password = login.password;
                    if (!password) return;

                    const pattern = this.checkPassword(password);
                    if (!pattern) return;

                    if (this.isIgnored(pattern.display, item.name)) return;

                    results[pattern.display].push({
                        name: item.name,
                        folder: this.folders[item.folderId] || 'N/A',
                        password: password,
                        creationDate: item.creationDate
                    });
                });

                return results;
            }

            renderStats(analysis) {
                let totalActive = 0;
                let totalSafe = 0;

                if (this.data.items) {
                    totalSafe = this.data.items.filter(i => i.type === 1 && i.login?.password).length;
                    Object.values(analysis).forEach(items => {
                        totalActive += items.length;
                    });
                    totalSafe -= totalActive;
                }

                const total = totalActive + totalSafe;
                const risk = total > 0 ? Math.round(totalActive / total * 100) : 0;

                const statsHtml = `
                    <div class="stat-card danger">
                        <div class="stat-label">üî¥ At Risk</div>
                        <div class="stat-number">${totalActive}</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-label">üü¢ Safe</div>
                        <div class="stat-number">${totalSafe}</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-label">üìä Total</div>
                        <div class="stat-number">${total}</div>
                    </div>
                    <div class="stat-card danger">
                        <div class="stat-label">‚ö†Ô∏è Risk</div>
                        <div class="stat-number">${risk}%</div>
                    </div>
                `;
                document.getElementById('stats').innerHTML = statsHtml;
            }

            renderResults(analysis) {
                if (!this.patterns.length) {
                    document.getElementById('results').innerHTML = '<div class="empty-state"><div class="empty-state-icon">‚öôÔ∏è</div><p>Add patterns on the left to get started</p></div>';
                    return;
                }

                // Trouve le dossier ouvert
                let openedPattern = null;
                for (let pattern of this.patterns) {
                    if (!this.isFolderCollapsed(pattern.display)) {
                        openedPattern = pattern.display;
                        break;
                    }
                }

                let html = '';
                
                // Affiche d'abord le dossier ouvert si existe
                if (openedPattern) {
                    const items = analysis[openedPattern] || [];
                    if (items.length > 0) {
                        const isCollapsed = this.isFolderCollapsed(openedPattern);
                        html += `
                            <div class="pattern-folder">
                                <div class="pattern-folder-header" onclick="checker.toggleFolder('${openedPattern.replace(/'/g, "\\'")}')">
                                    <span class="folder-toggle ${isCollapsed ? 'collapsed' : ''}">üìÅ</span>
                                    <span class="folder-title">${this.escapeHtml(openedPattern)}</span>
                                    <span class="folder-count">${items.length}</span>
                                    <span class="folder-minimize" onclick="event.stopPropagation(); checker.toggleFolder('${openedPattern.replace(/'/g, "\\'")}')">‚îÅ</span>
                                </div>
                                <div class="pattern-folder-content ${isCollapsed ? 'collapsed' : ''}">
                                    ${items.map((item) => {
                                        const link = this.getLink(item.name);
                                        return `
                                            <div class="result-item ${this.isTracked(openedPattern, item.name) ? 'tracked' : ''}" onclick="checker.toggleTracked('${this.escapeHtml(openedPattern)}', '${this.escapeHtml(item.name)}')">
                                                <div style="display: flex; justify-content: space-between; align-items: flex-start;">
                                                    <a href="${this.escapeHtml(link)}" target="_blank" class="result-link" onclick="event.stopPropagation()">${this.escapeHtml(item.name)}</a>
                                                    <span onclick="event.stopPropagation()">
                                                        <input type="checkbox" class="checkbox-ignore" title="Ignore this Website password combo" onchange="checker.markAsIgnored('${this.escapeHtml(openedPattern)}', '${this.escapeHtml(item.name)}')">
                                                        <span style="font-size: 0.7em; color: var(--text-secondary);">Ignore</span>
                                                    </span>
                                                </div>
                                                <div style="display: flex; gap: 4px; flex-wrap: wrap; align-items: center;">
                                                    <span class="result-folder">${item.folder}</span>
                                                    <span class="result-date">${this.formatDate(item.creationDate)}</span>
                                                    <span class="result-password" style="margin-left: auto;">
                                                        <span>üîë</span>
                                                        <span class="password-value">${this.escapeHtml(item.password)}</span>
                                                    </span>
                                                </div>
                                            </div>
                                        `;
                                    }).join('')}
                                </div>
                            </div>
                        `;
                    }
                }

                // Puis affiche tous les autres dossiers ferm√©s
                Object.entries(analysis).forEach(([patternName, items]) => {
                    if (items.length === 0) return;
                    if (patternName === openedPattern) return; // Skip si d√©j√† affich√©

                    const isCollapsed = this.isFolderCollapsed(patternName);
                    html += `
                        <div class="pattern-folder">
                            <div class="pattern-folder-header" onclick="checker.toggleFolder('${patternName.replace(/'/g, "\\'")}')">
                                <span class="folder-toggle ${isCollapsed ? 'collapsed' : ''}">üìÅ</span>
                                <span class="folder-title">${this.escapeHtml(patternName)}</span>
                                <span class="folder-count">${items.length}</span>
                                <span class="folder-minimize" onclick="event.stopPropagation(); checker.toggleFolder('${patternName.replace(/'/g, "\\'")}')">‚îÅ</span>
                            </div>
                            <div class="pattern-folder-content ${isCollapsed ? 'collapsed' : ''}">
                                ${items.map((item) => {
                                    const link = this.getLink(item.name);
                                    return `
                                        <div class="result-item ${this.isTracked(patternName, item.name) ? 'tracked' : ''}" onclick="checker.toggleTracked('${this.escapeHtml(patternName)}', '${this.escapeHtml(item.name)}')">
                                            <div style="display: flex; justify-content: space-between; align-items: flex-start;">
                                                <a href="${this.escapeHtml(link)}" target="_blank" class="result-link" onclick="event.stopPropagation()">${this.escapeHtml(item.name)}</a>
                                                <span onclick="event.stopPropagation()">
                                                    <input type="checkbox" class="checkbox-ignore" title="Ignore this Website password combo" onchange="checker.markAsIgnored('${this.escapeHtml(patternName)}', '${this.escapeHtml(item.name)}')">
                                                    <span style="font-size: 0.7em; color: var(--text-secondary);">Ignore</span>
                                                </span>
                                            </div>
                                            <div style="display: flex; gap: 4px; flex-wrap: wrap; align-items: center;">
                                                <span class="result-folder">${item.folder}</span>
                                                <span class="result-date">${this.formatDate(item.creationDate)}</span>
                                                <span class="result-password" style="margin-left: auto;">
                                                    <span>üîë</span>
                                                    <span class="password-value">${this.escapeHtml(item.password)}</span>
                                                </span>
                                            </div>
                                        </div>
                                    `;
                                }).join('')}
                            </div>
                        </div>
                    `;
                });

                document.getElementById('results').innerHTML = html || '<div class="empty-state"><div class="empty-state-icon">‚úÖ</div><p>All patterns are safe!</p></div>';
                this.renderIgnoredList();
            }

            escapeHtml(text) {
                const map = { '&': '&amp;', '<': '&lt;', '>': '&gt;', '"': '&quot;', "'": '&#039;' };
                return text.replace(/[&<>"']/g, m => map[m]);
            }
        }

        const checker = new DarkWebChecker();
    </script>
</body>
</html>